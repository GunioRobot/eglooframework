# Sample .htaccess file for eGloo applications

# Deployment Type
# SetEnv EG_ENV PRODUCTION
# SetEnv EG_ENV STAGING
SetEnv EG_ENV DEVELOPMENT

# Application / Bundle Selection
SetEnv EG_APP eGloo/Default.gloo
SetEnv EG_UI  OverlayInterface
# SetEnv EG_UI  Default
# SetEnv EG_APP Demos/PetFood
# SetEnv EG_UI Default
# SetEnv EG_APP Demos/BookResale
# SetEnv EG_UI Default
# SetEnv EG_APP Demos/DogOwners
# SetEnv EG_UI Default
# SetEnv EG_APP Demos/ImageHosting
# SetEnv EG_UI Default

# Caching
SetEnv EG_CACHE ON
SetEnv EG_CACHE_APC OFF
SetEnv EG_CACHE_FILE OFF
SetEnv EG_CACHE_MEMCACHE ON

# Database Engine
SetEnv EG_DB_ENGINE POSTGRESQL
# SetEnv EG_DB_ENGINE MYSQL

# Errors
SetEnv EG_DISPLAY_ERRORS ON
SetEnv EG_DISPLAY_TRACES ON

# Logging
# SetEnv EG_LOG_LEVEL PRODUCTION
# SetEnv EG_LOG_LEVEL STAGING
SetEnv EG_LOG_LEVEL DEVELOPMENT
SetEnv EG_LOG_FORMAT LOG

SetEnv EG_REWRITE_BASE /egloo

# Sanity Checking
SetEnv EG_SANITY_CHECK_CLASS_LOADING ON

# Rewrite Rules
<IfModule rewrite_module> 
RewriteEngine on 

# Modify the RewriteBase if you are using eGloo in a subdirectory
RewriteBase /egloo

# No rule for files that exist in the webroot
RewriteCond %{REQUEST_FILENAME} ^files/.*\.[a-z0-9]+ [OR]
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^files/(.*\.[a-z0-9]+)$ - [L]

# But we might have files referenced here in the applications bundle
RewriteCond %{REQUEST_FILENAME} ^files/.*\.[a-z0-9]+ [OR]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^files/(.*\.[a-z0-9]+)$ index.php?eg_requestClass=file&eg_requestID=rawfile&file_name=$1 [L]

# No rule for images that exist in the webroot
RewriteCond %{REQUEST_FILENAME} ^images/.*\.gif [OR]
RewriteCond %{REQUEST_FILENAME} ^images/.*\.GIF [OR]
RewriteCond %{REQUEST_FILENAME} ^images/.*\.png [OR]
RewriteCond %{REQUEST_FILENAME} ^images/.*\.PNG [OR]
RewriteCond %{REQUEST_FILENAME} ^images/.*\.jpg [OR]
RewriteCond %{REQUEST_FILENAME} ^images/.*\.JPG [OR]
RewriteCond %{REQUEST_FILENAME} ^images/.*\.jpeg [OR]
RewriteCond %{REQUEST_FILENAME} ^images/.*\.JPEG [OR]
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^images/(.*(.gif|.GIF|.png|.PNG|.jpg|.JPG|.jpeg|.JPEG))$ - [L]

# But we might have images referenced here in the applications bundle
RewriteCond %{REQUEST_FILENAME} ^images/.*\.gif [OR]
RewriteCond %{REQUEST_FILENAME} ^images/.*\.GIF [OR]
RewriteCond %{REQUEST_FILENAME} ^images/.*\.png [OR]
RewriteCond %{REQUEST_FILENAME} ^images/.*\.PNG [OR]
RewriteCond %{REQUEST_FILENAME} ^images/.*\.jpg [OR]
RewriteCond %{REQUEST_FILENAME} ^images/.*\.JPG [OR]
RewriteCond %{REQUEST_FILENAME} ^images/.*\.jpeg [OR]
RewriteCond %{REQUEST_FILENAME} ^images/.*\.JPEG [OR]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^images/(.*(.gif|.GIF|.png|.PNG|.jpg|.JPG|.jpeg|.JPEG))$ index.php?eg_requestClass=image&eg_requestID=rawfile&image_name=$1 [L]

# No rule for media files that exist in the webroot
RewriteCond %{REQUEST_FILENAME} ^media/.*\.aac [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.AAC [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.dcr [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.DCR [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.flv [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.FLV [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.mov [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.MOV [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.mpg [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.MPG [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.mp3 [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.MP3 [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.mp4 [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.MP4 [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.ogg [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.OGG [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.swf [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.SWF [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.wma [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.WMA [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.wmv [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.WMV [OR]
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^media/(.*(.aac|.AAC|.dcr|.DCR|.flv|.FLV|.mov|.MOV|.mpg|.MPG|.mp3|.MP3|.mp4|.MP4|.ogg|.OGG|.swf|.SWF|.wma|.WMA|.wmv|.WMV))$ - [L]

# But we might have files referenced here in the applications bundle
RewriteCond %{REQUEST_FILENAME} ^media/.*\.aac [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.AAC [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.dcr [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.DCR [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.flv [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.FLV [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.mov [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.MOV [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.mpg [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.MPG [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.mp3 [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.MP3 [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.mp4 [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.MP4 [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.ogg [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.OGG [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.swf [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.SWF [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.wma [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.WMA [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.wmv [OR]
RewriteCond %{REQUEST_FILENAME} ^media/.*\.WMV [OR]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^media/(.*(.aac|.AAC|.dcr|.DCR|.flv|.FLV|.mov|.MOV|.mpg|.MPG|.mp3|.MP3|.mp4|.MP4|.ogg|.OGG|.swf|.SWF|.wma|.WMA|.wmv|.WMV))$ index.php?eg_requestClass=media&eg_requestID=rawfile&media_name=$1 [L]

# Load 'static' css as dynamic css
RewriteRule ^css/([a-zA-Z0-9]+)\.css$ index.php?eg_requestClass=css&eg_requestID=$1 [L]

# Load 'static' javascript as dynamic javascript
RewriteRule ^(js|javascript)/(.+)\.js$ index.php?eg_requestClass=javascript&eg_requestID=$2 [L]

# Redirect anything two level deep to a class & id query
# Pass the remainder as the arguments to that RequestClass / RequestID Pair
# Make sure the argument list is clean -- allow alphanumerics, dot (.), dash (-)
# underscore (_) and ampersand (&).  Anything else should cascade down to the
# last rule
RewriteRule ^([a-zA-Z0-9]+)/([a-zA-Z0-9]+)$ index.php?eg_requestClass=$1&eg_requestID=$2 [L]
RewriteRule ^([a-zA-Z0-9]+)/([a-zA-Z0-9]+)/([a-zA-Z0-9\.\-\_\=\&\ ]*)$ index.php?eg_requestClass=$1&eg_requestID=$2&$3 [L]
RewriteRule ^$ index.php?eg_requestClass=externalMainPage&eg_requestID=extMainViewBase [L]

# The only script we allow direct access to
# NOTE: Required so that the last rule does not block us on previous redirects
RewriteRule ^index.php$ - [L]

# Forbid anything that doesn't fit one of the preceding patterns
# Should redirect to 404.  Currently redirects to /
RewriteRule ^.*$ - [F]
</IfModule>
